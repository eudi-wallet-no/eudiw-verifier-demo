package no.idporten.eudiw.demo.verifier.web;


import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.util.MultiValueMap;

import static org.junit.jupiter.api.Assertions.*;

@ActiveProfiles("junit")
@SpringBootTest
public class ResponseControllerTest {

    @Autowired
    private ResponseController responseController;

    @Test
    void testRetrieveElementsFromMDoc() {
        String vpToken = "o2d2ZXJzaW9uYzEuMGlkb2N1bWVudHOCo2dkb2NUeXBld2V1LmV1cm9wYS5lYy5ldWRpLnBpZC4xbGlzc3VlclNpZ25lZKJqbmFtZVNwYWNlc6F3ZXUuZXVyb3BhLmVjLmV1ZGkucGlkLjGB2BhYT6RoZGlnZXN0SUQAZnJhbmRvbVDEw6EVb0YyBYxTxNFRorchcWVsZW1lbnRJZGVudGlmaWVya2FnZV9vdmVyXzE4bGVsZW1lbnRWYWx1ZfVqaXNzdWVyQXV0aIRDoQEmoRghWQT7MIIE9zCCAt-gAwIBAgIIGm0u-iHXvpAwDQYJKoZIhvcNAQELBQAwZDEYMBYGA1UEYRMPTlRSTk8tOTkxODI1ODI3MQswCQYDVQQGEwJubzEPMA0GA1UECxMGRGlnZGlyMSowKAYDVQQDEyFlaWRhczJzYW5ka2Fzc2UgVkMgSXNzdWVyIENBIHRlc3QwHhcNMjUwNDMwMTAzMzIyWhcNMjUwODA4MTAzMzIyWjCBiTELMAkGA1UEBhMCbm8xLzAtBgNVBAsTJmRlbW8tdXRzdGVkZXIudGVzdC5laWRhczJzYW5ka2Fzc2UubmV0MS8wLQYDVQQDEyZkZW1vLXV0c3RlZGVyLnRlc3QuZWlkYXMyc2FuZGthc3NlLm5ldDEYMBYGA1UEYQwPTlRSTk8tOTkxODI1ODI3MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEFoAUErExQ3gpXMzbJMObTQy9XKELXusWAON_1jWTLUwbQ07wNhaxbQ4SqEbAJoN4sl3KIiLML4BmQ69KcXus1qOCAVAwggFMMB8GA1UdIwQYMBaAFORiFKDXs7WKkSciU_8oaym2SBFsMB0GA1UdDgQWBBTTE4DVg9Hji5wHVTQJ2kVRVePnXjAMBgNVHRMBAf8EAjAAMFYGA1UdHwRPME0wS6BJoEeGRWh0dHBzOi8vY2EudGVzdC5laWRhczJzYW5ka2Fzc2UubmV0L3YxL2NlcnRzL2ludGVybWVkaWF0ZXMvaXNzdWVyLmNybDAOBgNVHQ8BAf8EBAMCBaAwYQYIKwYBBQUHAQEEVTBTMFEGCCsGAQUFBzAChkVodHRwczovL2NhLnRlc3QuZWlkYXMyc2FuZGthc3NlLm5ldC92MS9jZXJ0cy9pbnRlcm1lZGlhdGVzL2lzc3Vlci5jZXIwMQYDVR0RBCowKIImZGVtby11dHN0ZWRlci50ZXN0LmVpZGFzMnNhbmRrYXNzZS5uZXQwDQYJKoZIhvcNAQELBQADggIBABU1c5oJAxy6wVSeeXaOtmWW02cdYWw7vHl_icHfSWRwwx_3bKgs1AG-c8UTCcKxshXPpsJzztj8_L-psy94H75oMivqtuYV1wEc3ldKAbYETwYyfhvck4PMTBAh_g3Bc0FYytpTfNUYukXpmJxHA8Iz2-yYMyu6IyH6cPFRt-phRTPPYbGrEwzGhlEK9fHMUpaxDUcHByq5aUodIpHtcCcN8jU9KaEDkK6bMpOrlInt-mz_j98Mf-T9c2lGI7INYodjqPmuhnLzQ1l_Nypn4wMKZkKIsJyCI5opWRFKyusg41ZU8c10CV9EE7vrw-_3WaRtzxil6W25fOmgGYHlARC1z4c4dj_d0tsTrxY_HgVD_5A1EVgzcMIuCvp6L-GSxj8V4X35B4RjMmTLWVoWDaish1DHXMHcmf92FPuxayomfl7xl4Tzbl-lS7IfQfqunoiEmMnXleM9HnxcEHumNcKTDJxfI_fMtw8zI4cPJ9f0OzyzTVFuDeh2FfBVVPpGQjQb5_NlQVc9gNuAYnFII377XdDiN-ROM-kZ-S5xYH0YpaDUe-55dtDGnxLVN3h9AyAOfRT78efCMs0Z2kw4UDWUNDpGPWJekfXzIDtsdpdxy86rmAb2cLLSpDTXUn3VjuCAy7ci2XYFTctelqecEGyAK9K5HrbbtU011YlLwbrEWQJB2BhZAjymZ3ZlcnNpb25jMS4wb2RpZ2VzdEFsZ29yaXRobWdTSEEtMjU2bHZhbHVlRGlnZXN0c6F3ZXUuZXVyb3BhLmVjLmV1ZGkucGlkLjGlAFggsza0M4JiszGSbNuFMufJHlZb2dSw6IcHZqEeckJ2u4gBWCBrjw1GLMD6-vSd06QoSnKLp2LL6dbWSc3VQKmQHzDmdAJYINoFXpVDt7hc_Wi3PkIzh3pVo3VMV8MF-KXnjYCLr74-A1gg3xL3Ze4JzNODAuT9Q2tgNZGlJ3lgc5fkAAuxVyNP4CoEWCCDvQI7qpdVRVLSOzxnGfcfcBsRA1dSS49KkZgLy649y21kZXZpY2VLZXlJbmZvoWlkZXZpY2VLZXmkAQIgASFYIBtI95WvzL12O-kvo4PB9WDHCn2Dwk1sZcflmA__W3BuIlggD82yeSPmhutf7JCG0f5DpKeE88x8WfwbdY-Ich3ZReRnZG9jVHlwZXdldS5ldXJvcGEuZWMuZXVkaS5waWQuMWx2YWxpZGl0eUluZm-kZnNpZ25lZMB4HjIwMjUtMDYtMTZUMDY6Mjk6MjAuODUzNzk5NDQ5Wml2YWxpZEZyb23AeB4yMDI1LTA2LTE2VDA2OjI5OjIwLjg1MzgwMDY0MFpqdmFsaWRVbnRpbMB4HjIwMjYtMDYtMTZUMDY6Mjk6MjAuODUzODAwODYxWm5leHBlY3RlZFVwZGF0ZcB4HjIwMjYtMDYtMTZUMDY6Mjk6MjAuODUzODA0NTE5WlhAxjLgz5Otc9j-cXzRumex2sdJKYjLaiWpEGVI9Pg2HUfY2Ek4R6rTv-GKHRrNQHo-1oP-RKBPs9Q5YrrwlzqkuWxkZXZpY2VTaWduZWSiam5hbWVTcGFjZXPYGEGgamRldmljZUF1dGihb2RldmljZVNpZ25hdHVyZYRDoQEmoPZYQLu7CctVqiXiG3kfCPZHxWMMe-rl-HUsp1s9__sBnBMLTYJxepexPaYaDbSdXc3N2dd6oZErnzZP7XGrc8xCa2mjZ2RvY1R5cGV3ZXUuZXVyb3BhLmVjLmV1ZGkucGlkLjFsaXNzdWVyU2lnbmVkompuYW1lU3BhY2VzoXdldS5ldXJvcGEuZWMuZXVkaS5waWQuMYHYGFhPpGhkaWdlc3RJRABmcmFuZG9tUA7T0XrnVldtIuEmnnnSs3ZxZWxlbWVudElkZW50aWZpZXJrYWdlX292ZXJfMThsZWxlbWVudFZhbHVl9Wppc3N1ZXJBdXRohEOhASahGCFZBPswggT3MIIC36ADAgECAggabS76Ide-kDANBgkqhkiG9w0BAQsFADBkMRgwFgYDVQRhEw9OVFJOTy05OTE4MjU4MjcxCzAJBgNVBAYTAm5vMQ8wDQYDVQQLEwZEaWdkaXIxKjAoBgNVBAMTIWVpZGFzMnNhbmRrYXNzZSBWQyBJc3N1ZXIgQ0EgdGVzdDAeFw0yNTA0MzAxMDMzMjJaFw0yNTA4MDgxMDMzMjJaMIGJMQswCQYDVQQGEwJubzEvMC0GA1UECxMmZGVtby11dHN0ZWRlci50ZXN0LmVpZGFzMnNhbmRrYXNzZS5uZXQxLzAtBgNVBAMTJmRlbW8tdXRzdGVkZXIudGVzdC5laWRhczJzYW5ka2Fzc2UubmV0MRgwFgYDVQRhDA9OVFJOTy05OTE4MjU4MjcwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAAQWgBQSsTFDeClczNskw5tNDL1coQte6xYA43_WNZMtTBtDTvA2FrFtDhKoRsAmg3iyXcoiIswvgGZDr0pxe6zWo4IBUDCCAUwwHwYDVR0jBBgwFoAU5GIUoNeztYqRJyJT_yhrKbZIEWwwHQYDVR0OBBYEFNMTgNWD0eOLnAdVNAnaRVFV4-deMAwGA1UdEwEB_wQCMAAwVgYDVR0fBE8wTTBLoEmgR4ZFaHR0cHM6Ly9jYS50ZXN0LmVpZGFzMnNhbmRrYXNzZS5uZXQvdjEvY2VydHMvaW50ZXJtZWRpYXRlcy9pc3N1ZXIuY3JsMA4GA1UdDwEB_wQEAwIFoDBhBggrBgEFBQcBAQRVMFMwUQYIKwYBBQUHMAKGRWh0dHBzOi8vY2EudGVzdC5laWRhczJzYW5ka2Fzc2UubmV0L3YxL2NlcnRzL2ludGVybWVkaWF0ZXMvaXNzdWVyLmNlcjAxBgNVHREEKjAogiZkZW1vLXV0c3RlZGVyLnRlc3QuZWlkYXMyc2FuZGthc3NlLm5ldDANBgkqhkiG9w0BAQsFAAOCAgEAFTVzmgkDHLrBVJ55do62ZZbTZx1hbDu8eX-Jwd9JZHDDH_dsqCzUAb5zxRMJwrGyFc-mwnPO2Pz8v6mzL3gfvmgyK-q25hXXARzeV0oBtgRPBjJ-G9yTg8xMECH-DcFzQVjK2lN81Ri6RemYnEcDwjPb7JgzK7ojIfpw8VG36mFFM89hsasTDMaGUQr18cxSlrENRwcHKrlpSh0ike1wJw3yNT0poQOQrpsyk6uUie36bP-P3wx_5P1zaUYjsg1ih2Oo-a6GcvNDWX83KmfjAwpmQoiwnIIjmilZEUrK6yDjVlTxzXQJX0QTu-vD7_dZpG3PGKXpbbl86aAZgeUBELXPhzh2P93S2xOvFj8eBUP_kDURWDNwwi4K-nov4ZLGPxXhffkHhGMyZMtZWhYNqKyHUMdcwdyZ_3YU-7FrKiZ-XvGXhPNuX6VLsh9B-q6eiISYydeV4z0efFwQe6Y1wpMMnF8j98y3DzMjhw8n1_Q7PLNNUW4N6HYV8FVU-kZCNBvn82VBVz2A24BicUgjfvtd0OI35E4z6Rn5LnFgfRiloNR77nl20MafEtU3eH0DIA59FPvx58IyzRnaTDhQNZQ0OkY9Yl6R9fMgO2x2l3HLzquYBvZwstKkNNdSfdWO4IDLtyLZdgVNy16Wp5wQbIAr0rkettu1TTXViUvBusRZAkHYGFkCPKZndmVyc2lvbmMxLjBvZGlnZXN0QWxnb3JpdGhtZ1NIQS0yNTZsdmFsdWVEaWdlc3RzoXdldS5ldXJvcGEuZWMuZXVkaS5waWQuMaUAWCA8teroreJtmAHfC7zJAXyCclFMFZtdUf6O_RZY0fp3WAFYICGGc-6x1N5fc7nRByO1wdA-47AYncdDl6_DgbGgepZjAlgg_NCExst-LaSizL8EwsotJkuAhU5PF-3yoTMCbHtdcXQDWCC0TBqMlBr_iCz-FoukVcgDVpVxXvMcFYqFzIxmsCq_fgRYIBCYUmzWq_KBIrG_wd8J2JYi-fQy_c0vcDw2x37THHaabWRldmljZUtleUluZm-haWRldmljZUtleaQBAiABIVggVj9c2gNDyx4yg5eSVHlsNWqrsaGvblhUD6lbTtszOtIiWCABaXw8gXSmWPteJcW-Tyl4aMOLfgT29DKVxcbrfpMvDGdkb2NUeXBld2V1LmV1cm9wYS5lYy5ldWRpLnBpZC4xbHZhbGlkaXR5SW5mb6Rmc2lnbmVkwHgeMjAyNS0wNi0yNFQwODo0Mzo1MS45OTE0NDI5MDVaaXZhbGlkRnJvbcB4HjIwMjUtMDYtMjRUMDg6NDM6NTEuOTkxNDQzOTA2Wmp2YWxpZFVudGlswHgeMjAyNi0wNi0yNFQwODo0Mzo1MS45OTE0NDQyMTBabmV4cGVjdGVkVXBkYXRlwHgeMjAyNi0wNi0yNFQwODo0Mzo1MS45OTE0NDgxNTdaWEAZFu6ck3BK3zUq1s3pZ09JtsC4zUnFHJKjNCuogLfn3-86It-zzAcWRyFtTvyyD8WX5iGOMcMRJCEE8NWI8rhVbGRldmljZVNpZ25lZKJqbmFtZVNwYWNlc9gYQaBqZGV2aWNlQXV0aKFvZGV2aWNlU2lnbmF0dXJlhEOhASag9lhAm1Wb2RcBd8NLHkCTqRM0SQuMTfpHrEoGT6PiOZOgJwDB6-mWxlc4R0RkA2yk12kAqRJ8BvZIgU_z9DkbYZz9umZzdGF0dXMA";
        MultiValueMap<String, String> attributes = responseController.retrieveElementsFromPidDocumentInMDoc(vpToken);
        assertAll(
                () -> assertNotNull(attributes),
                () -> assertFalse(attributes.isEmpty()),
                () -> assertTrue(attributes.containsKey("age_over_18")),
                () -> assertTrue(attributes.get("age_over_18").contains("true"))
        );
    }

}
